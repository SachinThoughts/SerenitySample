ePARSPro_438913_SQL1=declare @InvoiceNumber varchar (100) set @InvoiceNumber = '*******' select distinct r.encounterid as 'Account #', i.invoicenumber 'Invoice #', p.facilitypatientid as MRN, p.firstname as 'FName', p.lastname as 'LName', i.servicefieldcode as 'Service Code/DRG', A.description as 'Department', i.servicepointcode as 'Location', PP.MajorPayorType AS 'Major Payer', (select top 1 touchcount from ePARSProDetail where invoiceid = (select ID from invoices where invoicenumber =@invoicenumber) order by touchcount desc) as '# of Touches', MLPS.EncounterOpenBalance as 'Total Balance', AD.Disposition as 'Disposition', CASE WHEN ABS(ISNULL(MLPS.EncounterInsuranceBalance,0)+ISNULL(MLPS.EncounterPatientBalance,0)+ISNULL(MLPS.EncounterUnbilledAmount,0)) >= 250 OR DATEDIFF(DAY, ISNULL(WFS.NEXTFOLLOWUPDATE,getdate()), GETDATE()) > 6 THEN 'HIGH' WHEN ABS(ISNULL(MLPS.EncounterInsuranceBalance,0)+ISNULL(MLPS.EncounterPatientBalance,0)+ISNULL(MLPS.EncounterUnbilledAmount,0)) >= 50 OR (DATEDIFF(DAY, ISNULL(WFS.NEXTFOLLOWUPDATE,getdate()), GETDATE()) > 4 AND DATEDIFF(DAY, ISNULL(WFS.NEXTFOLLOWUPDATE,getdate()), GETDATE()) <= 6) THEN 'MEDIUM' ELSE 'LOW' END AS RiskLevel, U.UserName AS [UserName] , CONVERT(DATETIME, CONVERT(NVARCHAR(10), coalesce(WFS.UpdatedDate, WFS.CreatedDate), 101)) AS [LastActivityDate], ISNULL(Phy.LastName +', '+ Phy.FirstName,'N/A') as BillingProviderName from invoices i inner join registrations r on i.encounterid = r.encounterid inner join persons p on r.personid= p.id left join Workflowstatus WFS on i.id=wfs.invoiceid Left join MultiLevelPaymentSummary mlps on i.id=mlps.recordkey left join accretive_actions A on wfs.NextWFTActionID = A.id left join accretive_actiondispositions AD on A.id=AD.ActionId and AD.ID = (select top 1 NextWFTDispositionID from PAYER.DEFECTHANDOFF HDF where invoiceid = (select ID from invoices where invoicenumber =@invoicenumber) ) LEFT JOIN dbo.PayorPlans AS PP WITH (NOLOCK) ON PP.FacilityPlanCode = I.CurrentPayorPlanCode left join PAYER.DEFECTHANDOFF HDF ON AD.ID = HDF.NextWFTDispositionID and i.ID = HDF.InvoiceID LEFT JOIN DNN30_Users AS U WITH (NOLOCK) ON ISNULL(WFS.UpdatedBy, WFS.CreatedBy) =U.UserID LEFT JOIN Physicians AS Phy WITH (NOLOCK) ON I.BillingProviderNPI = Phy.NPI where i.invoicenumber = @InvoiceNumber and mlps.recordkeytypeid=4