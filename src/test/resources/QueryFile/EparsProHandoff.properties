ePARSPro_438913_SQL1=declare @InvoiceNumber varchar (100) set @InvoiceNumber = '*******' select distinct r.encounterid as 'Account #', i.invoicenumber 'Invoice #', p.facilitypatientid as MRN, p.firstname as 'FName' , p.lastname as 'LName', i.servicefieldcode as 'Service Code/DRG', A.description as 'Department', i.servicepointcode as 'Location', PP.MajorPayorType AS 'Major Payer', (select top 1 touchcount from ePARSProDetail where invoiceid = (select ID from invoices where invoicenumber =@invoicenumber) order by touchcount desc) as '# of Touches', MLPS.EncounterOpenBalance as 'Total Balance', AD.Disposition as 'Disposition', CASE WHEN ABS(ISNULL(MLPS.EncounterInsuranceBalance,0)+ISNULL(MLPS.EncounterPatientBalance,0)+ISNULL(MLPS.EncounterUnbilledAmount,0)) >= 250 OR DATEDIFF(DAY, ISNULL(WFS.NEXTFOLLOWUPDATE,getdate()), GETDATE()) > 6 THEN 'HIGH' WHEN ABS(ISNULL(MLPS.EncounterInsuranceBalance,0)+ISNULL(MLPS.EncounterPatientBalance,0)+ISNULL(MLPS.EncounterUnbilledAmount,0)) >= 50 OR (DATEDIFF(DAY, ISNULL(WFS.NEXTFOLLOWUPDATE,getdate()), GETDATE()) > 4 AND DATEDIFF(DAY, ISNULL(WFS.NEXTFOLLOWUPDATE,getdate()), GETDATE()) <= 6) THEN 'MEDIUM' ELSE 'LOW' END AS Risk, U.UserName AS [Last User] , DATEDIFF(DD,WFS.NextFollowupDate,GETDATE()) as 'Days Open', ISNULL(Phy.LastName +', '+ Phy.FirstName,'N/A') as 'Billing Provider Name', phy.SpecialtyDesc as 'Billing Physician Specialty' , WFS.NEXTFOLLOWUPDATE from invoices i inner join registrations r on i.encounterid = r.encounterid inner join persons p on r.personid= p.id Left join MultiLevelPaymentSummary mlps on i.id=mlps.recordkey LEFT JOIN dbo.PayorPlans AS PP WITH (NOLOCK) ON PP.FacilityPlanCode = I.CurrentPayorPlanCode left JOIN (SELECT * FROM( SELECT DefectHandoffID, RegistrationID, WorkflowStatusID, WorkFlowTypeID ,WorkFlowSubTypeID, NextWFTActionID, NextWFTDispositionID, InvoiceID, ROW_NUMBER() OVER (PARTITION BY RegistrationID,InvoiceID ORDER BY DefectHandoffID DESC) RowFlag FROM PAYER.DEFECTHANDOFF ) Y WHERE RowFlag = 1 ) HDF ON HDF.RegistrationID = i.RegistrationID and HDF.InvoiceID = ISNULL(i.ID,0) left join Workflowstatus WFS on WFS.id = hdf.WorkFlowStatusID left join accretive_actions A on A.id = HDF.NextWFTActionID left join accretive_actiondispositions AD on AD.ID = (select top 1 NextWFTDispositionID from PAYER.DEFECTHANDOFF HDF where invoiceid = (select ID from invoices where invoicenumber =@invoicenumber)) LEFT JOIN DNN30_Users AS U WITH (NOLOCK) ON ISNULL(WFS.UpdatedBy, WFS.CreatedBy) =U.UserID LEFT JOIN Physicians AS Phy WITH (NOLOCK) ON I.BillingProviderNPI = Phy.NPI where i.invoicenumber = @InvoiceNumber and mlps.recordkeytypeid=(select ID from Accretive_RecordKeyMaster where RecordKeyType ='InvoiceID')
ePARSPro_438926_SQL3=select top 1 * from persons
ePARSPro_438913_SQL26=Select top 1 Invoicenumber,i.ID,r.EncounterID from invoices i inner join registrations r on i.encounterid = r.encounterid where registrationid is not null order by id desc 